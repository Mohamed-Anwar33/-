<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>جدول المهام - الجدول الأول والثاني</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      html,
      body {
        height: 100%;
        width: 100%;
        font-family: "Tajawal", sans-serif;
        background-color: #f0f4f8;
        direction: rtl;
        margin: 0;
        padding: 0;
      }
      .container {
        padding: 15px;
        max-width: 1200px;
        margin: 0 auto;
      }
      h2,
      h3,
      h4 {
        color: #2c3e50;
        text-align: center;
        margin-bottom: 8px;
      }
      .small-text {
        font-size: 12px;
        text-align: right;
      }
      .table-section {
        margin-bottom: 10px;
      }
      .table {
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        margin-bottom: 15px;
      }
      .table-buttons {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-bottom: 20px;
      }
      .table th,
      .table td {
        text-align: center;
        vertical-align: middle;
        padding: 8px;
      }
      .action-buttons {
        display: flex;
        justify-content: center;
        gap: 5px;
        flex-wrap: wrap;
      }
      .edit-btn,
      .complete-btn,
      .delete-btn,
      .important-btn {
        margin: 2px;
        padding: 4px 8px;
        font-size: 12px;
        white-space: nowrap;
      }
      .completed-task {
        background-color: #d4edda !important;
        text-decoration: line-through;
      }
      .table-danger {
        background-color: #f8d7da !important;
      }
      .notes ul,
      .notes p {
        font-size: 11px;
      }
      .signature-section p {
        text-align: center;
        margin: 5px 0;
      }
      .time-input,
      .hijri-select {
        width: 80px;
        margin: 0 2px;
        display: inline-block;
      }
      .date-controls {
        display: flex;
        gap: 5px;
        justify-content: center;
      }
      .site-start-container {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 5px;
      }
      .site-start-container label {
        font-size: 12px;
        margin: 0;
      }
      .site-start-container input[type="time"],
      .site-start-container input[type="text"] {
        padding: 2px;
        border: 1px solid #ced4da;
        border-radius: 4px;
        font-size: 12px;
      }
      .site-start-container input[type="text"] {
        width: 120px;
      }
      @media print {
        .date-controls,
        .table-buttons,
        .edit-column,
        button,
        .action-buttons {
          display: none;
        }
      }
      @media (max-width: 430px) {
        .table {
          font-size: 9px;
          min-width: 600px;
        }
        .table-responsive {
          overflow-x: auto;
        }
        .edit-btn,
        .complete-btn,
        .delete-btn,
        .important-btn {
          padding: 2px 4px;
          font-size: 9px;
          min-width: 50px;
        }
        .container {
          padding: 5px;
        }
        .action-buttons {
          flex-direction: column;
          gap: 2px;
          justify-content: center;
        }
        .time-input,
        .hijri-select {
          width: 50px;
          font-size: 9px;
        }
        .site-start-container input[type="text"] {
          width: 80px;
        }
        .table th,
        .table td {
          padding: 3px;
        }
        .table td {
          white-space: normal;
          line-height: 1.2;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- العناوين -->
      <div class="text-center mt-3">
        <div class="small-text">
          <span class="editable" id="title1">السرية الأولى</span>
          <button
            class="btn btn-warning btn-sm edit-btn"
            onclick="editText('title1')"
          >
            تعديل
          </button>
        </div>
        <div class="small-text">
          <span class="editable" id="title2">فصيل (1)</span>
          <button
            class="btn btn-warning btn-sm edit-btn"
            onclick="editText('title2')"
          >
            تعديل
          </button>
        </div>
        <div class="small-text">
          <span class="editable" id="title3">مجموعة (7)</span>
          <button
            class="btn btn-warning btn-sm edit-btn"
            onclick="editText('title3')"
          >
            تعديل
          </button>
        </div>
        <h4 class="header fs-6 editable" id="title4">
          بيان بالمهام المكلفة بها قوة المهام والواجبات الخاصة ليوم
          <span id="selected-date"></span>
        </h4>
        <div class="date-controls mt-2">
          <select
            class="hijri-select"
            id="header-weekday"
            onchange="updateHeaderDate()"
          >
            <option value="السبت" selected>السبت</option>
            <option value="الأحد">الأحد</option>
            <option value="الإثنين">الإثنين</option>
            <option value="الثلاثاء">الثلاثاء</option>
            <option value="الأربعاء">الأربعاء</option>
            <option value="الخميس">الخميس</option>
            <option value="الجمعة">الجمعة</option>
          </select>
          <select
            class="hijri-select"
            id="header-day"
            onchange="updateHeaderDate()"
          >
            <!-- سيتم تعبئة الأيام ديناميكيًا -->
          </select>
          <select
            class="hijri-select"
            id="header-month"
            onchange="updateHeaderDate()"
          >
            <!-- سيتم تعبئة الشهور ديناميكيًا -->
          </select>
          <select
            class="hijri-select"
            id="header-year"
            onchange="updateHeaderDate()"
          >
            <!-- سيتم تعبئة السنوات ديناميكيًا -->
          </select>
        </div>
      </div>

      <!-- الجدول الأول -->
      <div class="table-responsive table-section">
        <table
          class="table table-bordered table-striped text-center align-middle"
          id="mainTable1"
        >
          <thead class="table-dark">
            <tr>
              <th>اليوم والتاريخ</th>
              <th>المباشرة بالموقع</th>
              <th>نوع المهمة</th>
              <th>الموقع</th>
              <th>المطلوب</th>
              <th class="edit-column">تعديل</th>
            </tr>
          </thead>
          <tbody>
            <!-- سيتم تعبئة الجدول ديناميكيًا -->
          </tbody>
        </table>
        <div class="table-buttons mt-3">
          <button
            class="btn btn-success btn-sm"
            onclick="addNewRow('mainTable1')"
          >
            إضافة صف
          </button>
          <button
            class="btn btn-primary btn-sm print-btn"
            onclick="printTable('mainTable1')"
          >
            طباعة
          </button>
        </div>
      </div>

      <!-- الجدول الثاني -->
      <div class="table-responsive table-section">
        <table
          class="table table-bordered table-striped text-center align-middle"
          id="mainTable2"
        >
          <thead class="table-dark">
            <tr>
              <th>اليوم والتاريخ</th>
              <th>المباشرة بالموقع</th>
              <th>نوع المهمة</th>
              <th>الموقع</th>
              <th>المطلوب</th>
              <th class="edit-column">تعديل</th>
            </tr>
          </thead>
          <tbody>
            <!-- سيتم تعبئة الجدول ديناميكيًا -->
          </tbody>
        </table>
        <div class="table-buttons mt-3">
          <button
            class="btn btn-success btn-sm"
            onclick="addNewRow('mainTable2')"
          >
            إضافة صف
          </button>
          <button
            class="btn btn-primary btn-sm print-btn"
            onclick="printTable('mainTable2')"
          >
            طباعة
          </button>
        </div>
      </div>

      <!-- المقدمة -->
      <div class="introduction mt-5">
        <p class="fs-6 text-end" style="margin-right: 30px">
          <span style="display: block; text-indent: -30px; padding-right: 30px"
            >ص/ ضباط خفر</span
          >
          <span style="display: block; text-indent: -30px; padding-right: 30px"
            >ص/ رقباء السرايا</span
          >
          <span style="display: block; text-indent: -30px; padding-right: 30px"
            >ص/ العمليات</span
          >
        </p>
        <p class="fs-6 text-end">
          السلام عليكم ورحمة الله وبركاته، تجولون أعلاه بيان بالمهام الأسبوعية
          المراد تغطيتها أمنياً من قبلكم، بالإضافة للمهام الطارئة، لذا عليكم
          متابعة تغطيتها بالوقت المحدد دون أي ملاحظات، مع التنبيه على العموم
          بارتداء السلاح والتجهيزات الميدانية اللازمة لكل مهمة كالخدمة والتنسيق
          معنا بما يستجد أول بأول،،، والسلام.
        </p>
      </div>

      <!-- الملاحظات -->
      <div class="notes mt-5">
        <h5 class="fs-6 editable" id="notesTitle">
          ملاحظات هامة جدا يجب الاطلاع عليها والتقيد بها حرفياً أثناء الاستلام:
        </h5>
        <button
          class="btn btn-warning btn-sm edit-btn"
          onclick="editText('notesTitle')"
        >
          تعديل
        </button>
        <ul style="font-size: 12px">
          <li>حراسة البوابة الرسمية.</li>
          <li>مهام طارئة تصل بشكل مفاجئ يجب الاستعداد لها.</li>
          <li>
            التقيد بالتوجيهات والاوامر والعمل بها وتنفيذها بكل دقة أثناء
            تأديتها.
          </li>
          <li>
            إعداد التقارير اللازمة لكل مهمة وتسليمها بعد الانتهاء منها مباشرة.
          </li>
          <li>التسلح والتجهيز المناسب ويكون حسب نوع المهمة.</li>
          <li>
            عند وجود أي ملاحظة أثناء المهمة يجب إبلاغ الضابط المستلم عن طريق
            غرفة العمليات أو الاتصال المباشر بنا وأخذ التوجيهات بهذا الشأن.
          </li>
          <li>أخذ الحيطة والحذر والاحتياطات الأمنية اللازمة من قبل الجميع.</li>
          <li>
            يمنع الخروج أثناء الاستلام لأي سبب وتكون المسئولية كاملة على الضابط
            المستلم.
          </li>
          <li>
            أي مهمة رسمية خلال الاستلام على الضابط المستلم مباشرتها وعلى
            مسؤوليته شخصياً.
          </li>
          <li>
            على الرقيب المستلم التعقيب على جميع المواقع المذكورة أعلاه والتأكد
            على عدم وجود أي ملاحظات في جميع المواقع والرفع لنا عن أي شيء يستوجب
            الرفع في حينه.
          </li>
          <li>
            في حال طلب مندوب للمشاركة بأي لجنة من قبل الإدارات الحكومية
            بالمنطقة، يكلف العدد الكافي من الأفراد والدوريات من قبل الضابط
            المستلم وتحت مسؤوليته شخصياً، وإشعارنا عن المهمة في حينها.
          </li>
          <li>
            التقيد بالحضور بالوقت المحدد وعدم الانصراف حتى أخذ التوجيه من
            العمليات.
          </li>
          <li>عدم تشغيل السيفتي أثناء التوجه للموقع والمغادرة منه.</li>
        </ul>

        <div class="signature-section">
          <p
            id="signatureName"
            class="editable text-left"
            style="
              font-size: 14px;
              font-family: 'Tajawal', sans-serif;
              text-align: left;
              line-height: 1.2;
              display: flex;
              flex-direction: column;
              align-items: flex-start;
              width: fit-content;
              margin: auto;
              margin-left: 40px;
              word-spacing: -1px;
              letter-spacing: -0.5px;
            "
          >
            <span>قائد قوة المهام والواجبات الخاصة</span>
            <span style="margin-top: 3px">عميد</span>
            <span style="margin-top: 3px; font-size: 15px"
              >فيصل بن خالد النفيسه</span
            >
          </p>
          <button
            class="btn btn-warning btn-sm edit-btn"
            onclick="editText('signatureName')"
          >
            تعديل
          </button>
        </div>
      </div>

      <!-- أزرار التنقل -->
      <div class="text-center mt-4 navigation-buttons">
        <a href="second.html" class="btn btn-secondary btn-sm">الجدول الثالث</a>
        <a href="pending_tasks.html" class="btn btn-warning btn-sm"
          >المهام المؤجلة</a
        >
        <a href="feauturetsaks.html" class="btn btn-warning btn-sm"
          >المهام المستقبلية</a
        >
        <a href="statistics.html" class="btn btn-secondary btn-sm">الإحصائية</a>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // قيم افتراضية للتاريخ الهجري
      let hijriYear = 1444;
      let hijriMonth = 8;
      let hijriDay = 5;
      let weekDay = "السبت";

      const hijriMonths = [
        "محرم",
        "صفر",
        "ربيع أول",
        "ربيع ثاني",
        "جمادى أول",
        "جمادى ثاني",
        "رجب",
        "شعبان",
        "رمضان",
        "شوال",
        "ذو القعدة",
        "ذو الحجة",
      ];
      const weekDays = [
        "السبت",
        "الأحد",
        "الإثنين",
        "الثلاثاء",
        "الأربعاء",
        "الخميس",
        "الجمعة",
      ];

      // تعبئة قوائم التاريخ الهجري
      function populateDateSelects() {
        const daySelects = document.querySelectorAll(
          "select[name='hijri-day']"
        );
        daySelects.forEach((select) => {
          select.innerHTML = Array.from({ length: 30 }, (_, i) => i + 1)
            .map(
              (day) =>
                `<option value="${day}" ${
                  day === hijriDay ? "selected" : ""
                }>${day}</option>`
            )
            .join("");
        });

        const monthSelects = document.querySelectorAll(
          "select[name='hijri-month']"
        );
        monthSelects.forEach((select) => {
          select.innerHTML = hijriMonths
            .map(
              (m, i) =>
                `<option value="${i + 1}" ${
                  i + 1 === hijriMonth ? "selected" : ""
                }>${m}</option>`
            )
            .join("");
        });

        const yearSelects = document.querySelectorAll(
          "select[name='hijri-year']"
        );
        yearSelects.forEach((select) => {
          select.innerHTML = Array.from({ length: 41 }, (_, i) => 1430 + i)
            .map(
              (year) =>
                `<option value="${year}" ${
                  year === hijriYear ? "selected" : ""
                }>${year}</option>`
            )
            .join("");
        });

        const weekDaySelects = document.querySelectorAll(
          "select[name='week-day']"
        );
        weekDaySelects.forEach((select) => {
          select.innerHTML = weekDays
            .map(
              (day) =>
                `<option value="${day}" ${
                  day === weekDay ? "selected" : ""
                }>${day}</option>`
            )
            .join("");
        });

        const headerDaySelect = document.getElementById("header-day");
        headerDaySelect.innerHTML = Array.from({ length: 30 }, (_, i) => i + 1)
          .map(
            (day) =>
              `<option value="${day}" ${
                day === hijriDay ? "selected" : ""
              }>${day}</option>`
          )
          .join("");

        const headerMonthSelect = document.getElementById("header-month");
        headerMonthSelect.innerHTML = hijriMonths
          .map(
            (m, i) =>
              `<option value="${i + 1}" ${
                i + 1 === hijriMonth ? "selected" : ""
              }>${m}</option>`
          )
          .join("");

        const headerYearSelect = document.getElementById("header-year");
        headerYearSelect.innerHTML = Array.from(
          { length: 41 },
          (_, i) => 1430 + i
        )
          .map(
            (year) =>
              `<option value="${year}" ${
                year === hijriYear ? "selected" : ""
              }>${year}</option>`
          )
          .join("");

        const headerWeekDaySelect = document.getElementById("header-weekday");
        headerWeekDaySelect.innerHTML = weekDays
          .map(
            (day) =>
              `<option value="${day}" ${
                day === weekDay ? "selected" : ""
              }>${day}</option>`
          )
          .join("");
      }

      // تحديث التاريخ في العنوان
      function updateHeaderDate() {
        weekDay = document.getElementById("header-weekday").value;
        hijriDay = parseInt(document.getElementById("header-day").value);
        hijriMonth = parseInt(document.getElementById("header-month").value);
        hijriYear = parseInt(document.getElementById("header-year").value);
        const selectedDate = `${weekDay} ${hijriDay} ${
          hijriMonths[hijriMonth - 1]
        } ${hijriYear}`;
        document.getElementById("selected-date").innerText = selectedDate;
        updateAllTables();
        saveTableData("mainTable1");
        saveTableData("mainTable2");
        updatePendingTasks();
      }

      // ترتيب المهام بناءً على وقت المباشرة
      function sortTableByStartTime(tableId) {
        const table = document
          .getElementById(tableId)
          .getElementsByTagName("tbody")[0];
        const rows = Array.from(table.getElementsByTagName("tr"));
        rows.sort((a, b) => {
          const timeA = a.cells[1].querySelector(
            "input[name='site-start-time']"
          ).value;
          const timeB = b.cells[1].querySelector(
            "input[name='site-start-time']"
          ).value;
          return timeA.localeCompare(timeB);
        });
        table.innerHTML = "";
        rows.forEach((row) => table.appendChild(row));
      }

      // إضافة صف جديد
      function addNewRow(tableId) {
        const table = document
          .getElementById(tableId)
          .getElementsByTagName("tbody")[0];
        const newRow = table.insertRow();
        newRow.innerHTML = `
          <td class="date-cell">
            <select class="hijri-select" name="week-day">
              ${weekDays
                .map(
                  (day) =>
                    `<option value="${day}" ${
                      day === weekDay ? "selected" : ""
                    }>${day}</option>`
                )
                .join("")}
            </select>
            <select class="hijri-select" name="hijri-day">
              ${Array.from({ length: 30 }, (_, i) => i + 1)
                .map(
                  (day) =>
                    `<option value="${day}" ${
                      day === hijriDay ? "selected" : ""
                    }>${day}</option>`
                )
                .join("")}
            </select>
            <select class="hijri-select" name="hijri-month">
              ${hijriMonths
                .map(
                  (m, i) =>
                    `<option value="${i + 1}" ${
                      i + 1 === hijriMonth ? "selected" : ""
                    }>${m}</option>`
                )
                .join("")}
            </select>
            <select class="hijri-select" name="hijri-year">
              ${Array.from({ length: 41 }, (_, i) => 1430 + i)
                .map(
                  (year) =>
                    `<option value="${year}" ${
                      year === hijriYear ? "selected" : ""
                    }>${year}</option>`
                )
                .join("")}
            </select>
          </td>
          <td>
            <div class="site-start-container">
              <label>المباشرة بالموقع:</label>
              <input type="time" class="time-input" name="site-start-time" value="06:00">
              <input type="text" name="site-start-text" placeholder="نص مفتوح">
            </div>
          </td>
          <td contenteditable="true">-</td>
          <td contenteditable="true">-</td>
          <td contenteditable="true">-</td>
          <td class="edit-column">
            <div class="action-buttons">
              <button class="btn btn-warning btn-sm edit-btn" onclick="editTable('${tableId}')">تعديل</button>
              <button class="btn btn-success btn-sm complete-btn" onclick="completeTask(this, '${tableId}')">اكتمال</button>
              <button class="btn btn-danger btn-sm delete-btn" onclick="deleteTask(this, '${tableId}')">حذف</button>
              <button class="btn btn-danger btn-sm important-btn" onclick="toggleImportant(this, '${tableId}')">تحديد كمهمة</button>
            </div>
          </td>
        `;
        saveTableData(tableId);
        sortTableByStartTime(tableId);
        updatePendingTasks();
      }

      // تعديل الجدول
      function editTable(tableId) {
        const table = document
          .getElementById(tableId)
          .getElementsByTagName("tbody")[0];
        const rows = table.getElementsByTagName("tr");
        for (let row of rows) {
          const cells = row.getElementsByTagName("td");
          cells[2].contentEditable = "true";
          cells[3].contentEditable = "true";
          cells[4].contentEditable = "true";
          const editButton = row.querySelector(".edit-btn");
          editButton.innerText = "حفظ";
          editButton.className = "btn btn-success btn-sm edit-btn";
          editButton.onclick = function () {
            saveTable(tableId);
          };
        }
      }

      // حفظ الجدول
      function saveTable(tableId) {
        const table = document
          .getElementById(tableId)
          .getElementsByTagName("tbody")[0];
        const rows = table.getElementsByTagName("tr");
        for (let row of rows) {
          const cells = row.getElementsByTagName("td");
          cells[2].contentEditable = "false";
          cells[3].contentEditable = "false";
          cells[4].contentEditable = "false";
          const editButton = row.querySelector(".edit-btn");
          editButton.innerText = "تعديل";
          editButton.className = "btn btn-warning btn-sm edit-btn";
          editButton.onclick = function () {
            editTable(tableId);
          };
        }
        saveTableData(tableId);
        sortTableByStartTime(tableId);
        updatePendingTasks();
      }

      // إكمال المهمة
      function completeTask(button, tableId) {
        const row = button.closest("tr");
        if (row.classList.contains("completed-task")) {
          row.classList.remove("completed-task");
          button.innerText = "اكتمال";
        } else {
          row.classList.add("completed-task");
          button.innerText = "إلغاء الاكتمال";
        }
        saveTableData(tableId);
        updatePendingTasks();
      }

      // حذف المهمة
      function deleteTask(button, tableId) {
        const row = button.closest("tr");
        row.remove();
        saveTableData(tableId);
        updatePendingTasks();
      }

      // تحديد المهمة كمهمة أهم
      function toggleImportant(button, tableId) {
        const row = button.closest("tr");
        const index = Array.from(row.parentNode.children).indexOf(row);
        const tasks = JSON.parse(
          localStorage.getItem(tableId + "_tasks") || "[]"
        );
        tasks[index][6] = !tasks[index][6]; // Toggle the isImportant flag
        localStorage.setItem(tableId + "_tasks", JSON.stringify(tasks));
        if (tasks[index][6]) {
          row.classList.add("table-danger");
          button.innerText = "إلغاء الأهمية";
        } else {
          row.classList.remove("table-danger");
          button.innerText = "تحديد كمهمة";
        }
        saveTableData(tableId);
      }

      // حفظ بيانات الجدول
      function saveTableData(tableId) {
        const table = document
          .getElementById(tableId)
          .getElementsByTagName("tbody")[0];
        const rows = table.getElementsByTagName("tr");
        const data = [];
        for (let row of rows) {
          const cells = row.getElementsByTagName("td");
          const weekDay = cells[0].querySelector(
            "select[name='week-day']"
          ).value;
          const day = cells[0].querySelector("select[name='hijri-day']").value;
          const month = cells[0].querySelector(
            "select[name='hijri-month']"
          ).value;
          const year = cells[0].querySelector(
            "select[name='hijri-year']"
          ).value;
          const siteStartTime = cells[1].querySelector(
            "input[name='site-start-time']"
          ).value;
          const siteStartText = cells[1].querySelector(
            "input[name='site-start-text']"
          ).value;
          const isCompleted = row.classList.contains("completed-task");
          const isImportant = row.classList.contains("table-danger");
          data.push([
            `${weekDay} ${day} ${hijriMonths[month - 1]} ${year}`,
            `المباشرة بالموقع: ${siteStartTime} | ${siteStartText}`,
            cells[2].innerText,
            cells[3].innerText,
            cells[4].innerText,
            isCompleted,
            isImportant,
          ]);
        }
        localStorage.setItem(tableId + "_tasks", JSON.stringify(data));
      }

      // تحميل بيانات الجدول
      function loadTableData(tableId) {
        const table = document
          .getElementById(tableId)
          .getElementsByTagName("tbody")[0];
        const savedData = localStorage.getItem(tableId + "_tasks");
        if (savedData) {
          table.innerHTML = "";
          JSON.parse(savedData).forEach((rowData) => {
            const [weekDay, day, monthName, year] = rowData[0].split(" ");
            const month = hijriMonths.indexOf(monthName) + 1;
            const [siteStartTime, siteStartText] = rowData[1]
              .split(" | ")
              .map((part) => part.replace("المباشرة بالموقع: ", ""));
            const isCompleted = rowData[5];
            const isImportant = rowData[6] || false;
            const row = table.insertRow();
            if (isCompleted) row.classList.add("completed-task");
            if (isImportant) row.classList.add("table-danger");
            row.innerHTML = `
              <td class="date-cell">
                <select class="hijri-select" name="week-day">
                  ${weekDays
                    .map(
                      (d) =>
                        `<option value="${d}" ${
                          d === weekDay ? "selected" : ""
                        }>${d}</option>`
                    )
                    .join("")}
                </select>
                <select class="hijri-select" name="hijri-day">
                  ${Array.from({ length: 30 }, (_, i) => i + 1)
                    .map(
                      (d) =>
                        `<option value="${d}" ${
                          d === parseInt(day) ? "selected" : ""
                        }>${d}</option>`
                    )
                    .join("")}
                </select>
                <select class="hijri-select" name="hijri-month">
                  ${hijriMonths
                    .map(
                      (m, i) =>
                        `<option value="${i + 1}" ${
                          i + 1 === parseInt(month) ? "selected" : ""
                        }>${m}</option>`
                    )
                    .join("")}
                </select>
                <select class="hijri-select" name="hijri-year">
                  ${Array.from({ length: 41 }, (_, i) => 1430 + i)
                    .map(
                      (y) =>
                        `<option value="${y}" ${
                          y === parseInt(year) ? "selected" : ""
                        }>${y}</option>`
                    )
                    .join("")}
                </select>
              </td>
              <td>
                <div class="site-start-container">
                  <label>المباشرة بالموقع:</label>
                  <input type="time" class="time-input" name="site-start-time" value="${siteStartTime}">
                  <input type="text" name="site-start-text" value="${siteStartText}" placeholder="نص مفتوح">
                </div>
              </td>
              <td contenteditable="false">${rowData[2]}</td>
              <td contenteditable="false">${rowData[3]}</td>
              <td contenteditable="false">${rowData[4]}</td>
              <td class="edit-column">
                <div class="action-buttons">
                  <button class="btn btn-warning btn-sm edit-btn" onclick="editTable('${tableId}')">تعديل</button>
                  <button class="btn btn-success btn-sm complete-btn" onclick="completeTask(this, '${tableId}')">${
              isCompleted ? "إلغاء الاكتمال" : "اكتمال"
            }</button>
                  <button class="btn btn-danger btn-sm delete-btn" onclick="deleteTask(this, '${tableId}')">حذف</button>
                  <button class="btn btn-danger btn-sm important-btn" onclick="toggleImportant(this, '${tableId}')">${
              isImportant ? "إلغاء الأهمية" : "تحديد كمهمة"
            }</button>
                </div>
              </td>
            `;
          });
          sortTableByStartTime(tableId);
        } else {
          const defaultTasks = [
            {
              siteStartTime: "06:00",
              siteStartText: "",
              type: "الاستعداد",
              location: "-",
              required: "-",
            },
            {
              siteStartTime: "03:30",
              siteStartText: "",
              type: "الاستعداد",
              location: "-",
              required: "-",
            },
            {
              siteStartTime: "13:30",
              siteStartText: "",
              type: "الاستعداد",
              location: "-",
              required: "-",
            },
            {
              siteStartTime: "14:00",
              siteStartText: "",
              type: "الاستعداد",
              location: "-",
              required: "-",
            },
          ];
          defaultTasks.forEach((task) => {
            const row = table.insertRow();
            row.innerHTML = `
              <td class="date-cell">
                <select class="hijri-select" name="week-day">
                  ${weekDays
                    .map(
                      (day) =>
                        `<option value="${day}" ${
                          day === weekDay ? "selected" : ""
                        }>${day}</option>`
                    )
                    .join("")}
                </select>
                <select class="hijri-select" name="hijri-day">
                  ${Array.from({ length: 30 }, (_, i) => i + 1)
                    .map(
                      (day) =>
                        `<option value="${day}" ${
                          day === hijriDay ? "selected" : ""
                        }>${day}</option>`
                    )
                    .join("")}
                </select>
                <select class="hijri-select" name="hijri-month">
                  ${hijriMonths
                    .map(
                      (m, i) =>
                        `<option value="${i + 1}" ${
                          i + 1 === hijriMonth ? "selected" : ""
                        }>${m}</option>`
                    )
                    .join("")}
                </select>
                <select class="hijri-select" name="hijri-year">
                  ${Array.from({ length: 41 }, (_, i) => 1430 + i)
                    .map(
                      (year) =>
                        `<option value="${year}" ${
                          year === hijriYear ? "selected" : ""
                        }>${year}</option>`
                    )
                    .join("")}
                </select>
              </td>
              <td>
                <div class="site-start-container">
                  <label>المباشرة بالموقع:</label>
                  <input type="time" class="time-input" name="site-start-time" value="${
                    task.siteStartTime
                  }">
                  <input type="text" name="site-start-text" value="${
                    task.siteStartText
                  }" placeholder="نص مفتوح">
                </div>
              </td>
              <td contenteditable="true">${task.type}</td>
              <td contenteditable="true">${task.location}</td>
              <td contenteditable="true">${task.required}</td>
              <td class="edit-column">
                <div class="action-buttons">
                  <button class="btn btn-warning btn-sm edit-btn" onclick="editTable('${tableId}')">تعديل</button>
                  <button class="btn btn-success btn-sm complete-btn" onclick="completeTask(this, '${tableId}')">اكتمال</button>
                  <button class="btn btn-danger btn-sm delete-btn" onclick="deleteTask(this, '${tableId}')">حذف</button>
                  <button class="btn btn-danger btn-sm important-btn" onclick="toggleImportant(this, '${tableId}')">تحديد كمهمة</button>
                </div>
              </td>
            `;
          });
          saveTableData(tableId);
          sortTableByStartTime(tableId);
        }
      }

      // تحديث جميع الجداول
      function updateAllTables() {
        ["mainTable1", "mainTable2"].forEach((tableId) => {
          const table = document
            .getElementById(tableId)
            .getElementsByTagName("tbody")[0];
          const rows = table.getElementsByTagName("tr");
          for (let row of rows) {
            const dateCell = row.cells[0];
            dateCell.innerHTML = `
              <select class="hijri-select" name="week-day">
                ${weekDays
                  .map(
                    (day) =>
                      `<option value="${day}" ${
                        day === weekDay ? "selected" : ""
                      }>${day}</option>`
                  )
                  .join("")}
              </select>
              <select class="hijri-select" name="hijri-day">
                ${Array.from({ length: 30 }, (_, i) => i + 1)
                  .map(
                    (day) =>
                      `<option value="${day}" ${
                        day === hijriDay ? "selected" : ""
                      }>${day}</option>`
                  )
                  .join("")}
              </select>
              <select class="hijri-select" name="hijri-month">
                ${hijriMonths
                  .map(
                    (m, i) =>
                      `<option value="${i + 1}" ${
                        i + 1 === hijriMonth ? "selected" : ""
                      }>${m}</option>`
                  )
                  .join("")}
              </select>
              <select class="hijri-select" name="hijri-year">
                ${Array.from({ length: 41 }, (_, i) => 1430 + i)
                  .map(
                    (year) =>
                      `<option value="${year}" ${
                        year === hijriYear ? "selected" : ""
                      }>${year}</option>`
                  )
                  .join("")}
              </select>
            `;
          }
        });
      }

      // تحديث المهام المؤجلة
      function updatePendingTasks() {
        const pendingTasks = [];
        ["mainTable1", "mainTable2"].forEach((tableId) => {
          const tableData = JSON.parse(
            localStorage.getItem(tableId + "_tasks") || "[]"
          );
          tableData.forEach((task) => {
            if (!task[5]) {
              pendingTasks.push(task);
            }
          });
        });
        localStorage.setItem("pending_tasks", JSON.stringify(pendingTasks));
      }

      // طباعة الجدول
      function printTable(tableId) {
        // إخفاء الأزرار
        const buttons = document.querySelectorAll("button, .action-buttons");
        buttons.forEach((button) => (button.style.display = "none"));

        // طباعة الصفحة
        window.print();

        // إعادة إظهار الأزرار بعد الطباعة
        buttons.forEach((button) => (button.style.display = ""));
      }

      // تعديل النصوص
      function editText(elementId) {
        const element = document.getElementById(elementId);
        const currentValue = element.innerHTML;
        element.innerHTML = `<input type="text" class="form-control form-control-sm" value="${currentValue}">`;
        const button = element.nextElementSibling;
        button.innerText = "حفظ";
        button.className = "btn btn-success btn-sm edit-btn";
        button.onclick = function () {
          saveText(elementId);
        };
      }

      // حفظ النصوص
      function saveText(elementId) {
        const element = document.getElementById(elementId);
        const input = element.getElementsByTagName("input")[0];
        element.innerHTML = input.value;
        const button = element.nextElementSibling;
        button.innerText = "تعديل";
        button.className = "btn btn-warning btn-sm edit-btn";
        button.onclick = function () {
          editText(elementId);
        };
        localStorage.setItem(elementId, input.value);
      }

      // تحميل البيانات عند فتح الصفحة
      document.addEventListener("DOMContentLoaded", function () {
        populateDateSelects();
        loadTableData("mainTable1");
        loadTableData("mainTable2");
        updateHeaderDate();
        updatePendingTasks();
      });
    </script>
  </body>
</html>
