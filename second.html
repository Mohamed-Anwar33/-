<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>الجدول الثالث</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      html,
      body {
        height: 100%;
        width: 100%;
        font-family: "Tajawal", sans-serif;
        background-color: #f0f4f8;
        direction: rtl;
        margin: 0;
        padding: 0;
      }
      .container {
        padding: 15px;
        max-width: 1200px;
        margin: 0 auto;
      }
      h2,
      h3,
      h4 {
        color: #2c3e50;
        text-align: center;
        margin-bottom: 8px;
      }
      .mission-info ul {
        font-size: 12px;
        text-align: center;
        margin-bottom: 10px;
      }
      .signature {
        font-size: 14px;
        margin-bottom: 10px;
      }
      .table-section {
        margin-bottom: 10px;
      }
      .table {
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        margin-bottom: 15px;
      }
      .table-buttons {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-bottom: 20px;
      }
      .table th,
      .table td {
        text-align: center;
        vertical-align: middle;
        padding: 8px;
      }
      .action-buttons {
        display: flex;
        justify-content: center;
        gap: 5px;
        flex-wrap: wrap;
      }
      .edit-btn,
      .complete-btn {
        margin: 2px;
        padding: 4px 8px;
        font-size: 12px;
        white-space: nowrap;
      }
      .time-input,
      .hijri-select {
        width: 80px;
        margin: 0 2px;
        display: inline-block;
      }
      .date-controls {
        display: flex;
        gap: 5px;
        justify-content: center;
      }
      .header-date {
        display: inline-block;
      }

      @media (min-width: 431px) {
        .table-responsive {
          overflow-x: hidden;
        }
      }

      @media (max-width: 430px) {
        .table {
          font-size: 10px;
          width: 100%;
        }
        .table th,
        .table td {
          padding: 4px;
        }
        .time-input,
        .hijri-select {
          width: 50px;
          font-size: 9px;
        }
        .action-buttons {
          flex-direction: row;
          gap: 3px;
        }
        .edit-btn,
        .complete-btn {
          padding: 2px 4px;
          font-size: 9px;
          min-width: 50px;
        }
        .container {
          padding: 5px;
        }
        .table td {
          white-space: normal;
          line-height: 1.2;
        }
      }

      @media print {
        .edit-btn,
        .complete-btn,
        .navigation-buttons {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="text-center mt-3">
        <div class="mission-info">
          <h3>(تبليغ مباشرة مهمة)</h3>
          <ul class="list-unstyled">
            <li>قائد السرايا للمتابعة</li>
            <li>ضابط الميدان للمتابعة</li>
            <li>ضابط خفر للمتابعة</li>
            <li>رقيب السرية فيما يخصكم</li>
            <li>رقيب فصل (6) فيما يخصكم</li>
            <li>رقيب مجموعة (7) فيما يخصكم</li>
            <li>رقيب العمليات</li>
            <li>رقيب الحركة والآليات</li>
          </ul>
          <div class="signature text-end">السلام عليكم ورحمة الله وبركاته</div>
          <h3 style="text-decoration: underline">عن المهمة التالية</h3>
        </div>

        <h2 class="fs-5">
          الجدول الثالث - ليوم
          <span class="header-date" id="hijri-date">
            <select class="hijri-select" name="header-week-day">
              <!-- سيتم تعبئتها ديناميكيًا -->
            </select>
            <select class="hijri-select" name="header-hijri-day">
              <!-- سيتم تعبئتها ديناميكيًا -->
            </select>
            <select class="hijri-select" name="header-hijri-month">
              <!-- سيتم تعبئتها ديناميكيًا -->
            </select>
            <select class="hijri-select" name="header-hijri-year">
              <!-- سيتم تعبئتها ديناميكيًا -->
            </select>
          </span>
        </h2>
        <div class="date-controls mt-2">
          <button class="btn btn-warning btn-sm" onclick="changeDate(1)">
            اليوم التالي
          </button>
          <button class="btn btn-warning btn-sm" onclick="changeDate(-1)">
            اليوم السابق
          </button>
        </div>

        <div class="table-responsive mt-4">
          <table
            class="table table-bordered table-striped text-center align-middle"
            id="secondTable"
          >
            <thead class="table-dark">
              <tr>
                <th>اليوم والتاريخ</th>
                <th>الوقت</th>
                <th>نوع المهمة</th>
                <th>الموقع</th>
                <th>تعديل</th>
              </tr>
            </thead>
            <tbody>
              <!-- سيتم تعبئة الجدول ديناميكيًا -->
            </tbody>
          </table>
        </div>
        <div class="table-buttons mt-3">
          <button
            class="btn btn-success btn-sm"
            onclick="addNewRow('secondTable')"
          >
            إضافة صف
          </button>
          <a href="index.html" class="btn btn-primary btn-sm"
            >عودة للجدول الرئيسي</a
          >
        </div>
      </div>
      <div class="signature text-end" style="margin-right: 20px">
        <p>قائد قوة المهام والواجبات الخاصة</p>
        <p>عقيد / فيصل بن خالد النفيسه</p>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // قيم افتراضية للتاريخ الهجري ويوم الأسبوع
      let hijriYear = 1446;
      let hijriMonth = 8;
      let hijriDay = 5;
      let weekDay = "السبت"; // قيمة افتراضية

      const hijriMonths = [
        "محرم",
        "صفر",
        "ربيع أول",
        "ربيع ثاني",
        "جمادى أول",
        "جمادى ثاني",
        "رجب",
        "شعبان",
        "رمضان",
        "شوال",
        "ذو القعدة",
        "ذو الحجة",
      ];

      const weekDays = [
        "السبت",
        "الأحد",
        "الإثنين",
        "الثلاثاء",
        "الأربعاء",
        "الخميس",
        "الجمعة",
      ];

      // تعبئة قوائم التاريخ الهجري وأيام الأسبوع
      function populateDateSelects() {
        // تعبئة الأيام (1-30)
        const daySelects = document.querySelectorAll(
          "select[name='header-hijri-day'], select[name='hijri-day']"
        );
        daySelects.forEach((select) => {
          select.innerHTML = Array.from({ length: 30 }, (_, i) => i + 1)
            .map(
              (day) =>
                `<option value="${day}" ${
                  day === hijriDay ? "selected" : ""
                }>${day}</option>`
            )
            .join("");
        });

        // تعبئة الأشهر
        const monthSelects = document.querySelectorAll(
          "select[name='header-hijri-month'], select[name='hijri-month']"
        );
        monthSelects.forEach((select) => {
          select.innerHTML = hijriMonths
            .map(
              (m, i) =>
                `<option value="${i + 1}" ${
                  i + 1 === hijriMonth ? "selected" : ""
                }>${m}</option>`
            )
            .join("");
        });

        // تعبئة السنوات (1430-1470)
        const yearSelects = document.querySelectorAll(
          "select[name='header-hijri-year'], select[name='hijri-year']"
        );
        yearSelects.forEach((select) => {
          select.innerHTML = Array.from({ length: 41 }, (_, i) => 1430 + i)
            .map(
              (year) =>
                `<option value="${year}" ${
                  year === hijriYear ? "selected" : ""
                }>${year}</option>`
            )
            .join("");
        });

        // تعبئة أيام الأسبوع
        const weekDaySelects = document.querySelectorAll(
          "select[name='header-week-day'], select[name='week-day']"
        );
        weekDaySelects.forEach((select) => {
          select.innerHTML = weekDays
            .map(
              (day) =>
                `<option value="${day}" ${
                  day === weekDay ? "selected" : ""
                }>${day}</option>`
            )
            .join("");
        });
      }

      // تحديث التاريخ في العنوان والجدول
      function updateHeaderDate() {
        const weekDaySelect = document.querySelector(
          "select[name='header-week-day']"
        );
        const daySelect = document.querySelector(
          "select[name='header-hijri-day']"
        );
        const monthSelect = document.querySelector(
          "select[name='header-hijri-month']"
        );
        const yearSelect = document.querySelector(
          "select[name='header-hijri-year']"
        );
        weekDay = weekDaySelect.value;
        hijriDay = parseInt(daySelect.value);
        hijriMonth = parseInt(monthSelect.value);
        hijriYear = parseInt(yearSelect.value);
        updateTable();
        saveTableData("secondTable");
      }

      // تغيير التاريخ الهجري
      function changeDate(delta) {
        hijriDay += delta;
        if (hijriDay > 30) {
          hijriDay = 1;
          hijriMonth++;
          if (hijriMonth > 12) {
            hijriMonth = 1;
            hijriYear++;
          }
        } else if (hijriDay < 1) {
          hijriDay = 30;
          hijriMonth--;
          if (hijriMonth < 1) {
            hijriMonth = 12;
            hijriYear--;
          }
        }
        populateDateSelects();
        updateTable();
        saveTableData("secondTable");
      }

      // ترتيب المهام بناءً على الوقت
      function sortTableByTime(tableId) {
        const table = document
          .getElementById(tableId)
          .getElementsByTagName("tbody")[0];
        const rows = Array.from(table.getElementsByTagName("tr"));
        rows.sort((a, b) => {
          const timeA = a.cells[1].querySelector(
            "input[name='task-time']"
          ).value;
          const timeB = b.cells[1].querySelector(
            "input[name='task-time']"
          ).value;
          return timeA.localeCompare(timeB);
        });
        table.innerHTML = "";
        rows.forEach((row) => table.appendChild(row));
      }

      function addNewRow(tableId) {
        const table = document
          .getElementById(tableId)
          .getElementsByTagName("tbody")[0];
        const newRow = table.insertRow();
        newRow.innerHTML = `
          <td class="date-cell">
            <select class="hijri-select" name="week-day">
              ${weekDays
                .map(
                  (day) =>
                    `<option value="${day}" ${
                      day === weekDay ? "selected" : ""
                    }>${day}</option>`
                )
                .join("")}
            </select>
            <select class="hijri-select" name="hijri-day">
              ${Array.from({ length: 30 }, (_, i) => i + 1)
                .map(
                  (day) =>
                    `<option value="${day}" ${
                      day === hijriDay ? "selected" : ""
                    }>${day}</option>`
                )
                .join("")}
            </select>
            <select class="hijri-select" name="hijri-month">
              ${hijriMonths
                .map(
                  (m, i) =>
                    `<option value="${i + 1}" ${
                      i + 1 === hijriMonth ? "selected" : ""
                    }>${m}</option>`
                )
                .join("")}
            </select>
            <select class="hijri-select" name="hijri-year">
              ${Array.from({ length: 41 }, (_, i) => 1430 + i)
                .map(
                  (year) =>
                    `<option value="${year}" ${
                      year === hijriYear ? "selected" : ""
                    }>${year}</option>`
                )
                .join("")}
            </select>
          </td>
          <td>
            <input type="time" class="time-input" name="task-time" value="09:00">
          </td>
          <td contenteditable="true">دورية</td>
          <td contenteditable="true">المنطقة أ</td>
          <td class="action-buttons">
            <button class="btn btn-warning btn-sm edit-btn" onclick="editRow(this)">تعديل</button>
            <button class="btn btn-success btn-sm complete-btn" onclick="completeTask(this)">اكتمال</button>
          </td>
        `;
        saveTableData(tableId);
        sortTableByTime(tableId);
      }

      function editRow(button) {
        const row = button.closest("tr");
        const cells = row.getElementsByTagName("td");
        cells[2].contentEditable = "true";
        cells[3].contentEditable = "true";
        button.innerText = "حفظ";
        button.className = "btn btn-success btn-sm edit-btn";
        button.onclick = function () {
          saveRow(button);
        };
      }

      function saveRow(button) {
        const row = button.closest("tr");
        const cells = row.getElementsByTagName("td");
        cells[2].contentEditable = "false";
        cells[3].contentEditable = "false";
        button.innerText = "تعديل";
        button.className = "btn btn-warning btn-sm edit-btn";
        button.onclick = function () {
          editRow(button);
        };
        saveTableData("secondTable");
        sortTableByTime("secondTable");
      }

      function completeTask(button) {
        const row = button.closest("tr");
        row.remove();
        saveTableData("secondTable");
      }

      function saveTableData(tableId) {
        const table = document
          .getElementById(tableId)
          .getElementsByTagName("tbody")[0];
        const rows = table.getElementsByTagName("tr");
        const data = [];
        for (let row of rows) {
          const cells = row.getElementsByTagName("td");
          const weekDay = cells[0].querySelector(
            "select[name='week-day']"
          ).value;
          const day = cells[0].querySelector("select[name='hijri-day']").value;
          const month = cells[0].querySelector(
            "select[name='hijri-month']"
          ).value;
          const year = cells[0].querySelector(
            "select[name='hijri-year']"
          ).value;
          const taskTime = cells[1].querySelector(
            "input[name='task-time']"
          ).value;
          data.push([
            `${weekDay} ${day} ${hijriMonths[month - 1]} ${year}`,
            taskTime,
            cells[2].innerText,
            cells[3].innerText,
          ]);
        }
        localStorage.setItem(tableId + "_tasks", JSON.stringify(data));
      }

      function loadTableData(tableId) {
        const table = document
          .getElementById(tableId)
          .getElementsByTagName("tbody")[0];
        const savedData = localStorage.getItem(tableId + "_tasks");
        if (savedData) {
          table.innerHTML = "";
          JSON.parse(savedData).forEach((rowData) => {
            const [weekDay, day, monthName, year] = rowData[0].split(" ");
            const month = hijriMonths.indexOf(monthName) + 1;
            const row = table.insertRow();
            row.innerHTML = `
              <td class="date-cell">
                <select class="hijri-select" name="week-day">
                  ${weekDays
                    .map(
                      (d) =>
                        `<option value="${d}" ${
                          d === weekDay ? "selected" : ""
                        }>${d}</option>`
                    )
                    .join("")}
                </select>
                <select class="hijri-select" name="hijri-day">
                  ${Array.from({ length: 30 }, (_, i) => i + 1)
                    .map(
                      (d) =>
                        `<option value="${d}" ${
                          d === parseInt(day) ? "selected" : ""
                        }>${d}</option>`
                    )
                    .join("")}
                </select>
                <select class="hijri-select" name="hijri-month">
                  ${hijriMonths
                    .map(
                      (m, i) =>
                        `<option value="${i + 1}" ${
                          i + 1 === parseInt(month) ? "selected" : ""
                        }>${m}</option>`
                    )
                    .join("")}
                </select>
                <select class="hijri-select" name="hijri-year">
                  ${Array.from({ length: 41 }, (_, i) => 1430 + i)
                    .map(
                      (y) =>
                        `<option value="${y}" ${
                          y === parseInt(year) ? "selected" : ""
                        }>${y}</option>`
                    )
                    .join("")}
                </select>
              </td>
              <td>
                <input type="time" class="time-input" name="task-time" value="${
                  rowData[1]
                }">
              </td>
              <td contenteditable="false">${rowData[2]}</td>
              <td contenteditable="false">${rowData[3]}</td>
              <td class="action-buttons">
                <button class="btn btn-warning btn-sm edit-btn" onclick="editRow(this)">تعديل</button>
                <button class="btn btn-success btn-sm complete-btn" onclick="completeTask(this)">اكتمال</button>
              </td>
            `;
          });
          sortTableByTime(tableId);
        } else {
          const row = table.insertRow();
          row.innerHTML = `
            <td class="date-cell">
              <select class="hijri-select" name="week-day">
                ${weekDays
                  .map(
                    (day) =>
                      `<option value="${day}" ${
                        day === weekDay ? "selected" : ""
                      }>${day}</option>`
                  )
                  .join("")}
              </select>
              <select class="hijri-select" name="hijri-day">
                ${Array.from({ length: 30 }, (_, i) => i + 1)
                  .map(
                    (day) =>
                      `<option value="${day}" ${
                        day === hijriDay ? "selected" : ""
                      }>${day}</option>`
                  )
                  .join("")}
              </select>
              <select class="hijri-select" name="hijri-month">
                ${hijriMonths
                  .map(
                    (m, i) =>
                      `<option value="${i + 1}" ${
                        i + 1 === hijriMonth ? "selected" : ""
                      }>${m}</option>`
                  )
                  .join("")}
              </select>
              <select class="hijri-select" name="hijri-year">
                ${Array.from({ length: 41 }, (_, i) => 1430 + i)
                  .map(
                    (year) =>
                      `<option value="${year}" ${
                        year === hijriYear ? "selected" : ""
                      }>${year}</option>`
                  )
                  .join("")}
              </select>
            </td>
            <td>
              <input type="time" class="time-input" name="task-time" value="09:00">
            </td>
            <td contenteditable="true">دورية</td>
            <td contenteditable="true">المنطقة أ</td>
            <td class="action-buttons">
              <button class="btn btn-warning btn-sm edit-btn" onclick="editRow(this)">تعديل</button>
              <button class="btn btn-success btn-sm complete-btn" onclick="completeTask(this)">اكتمال</button>
            </td>
          `;
          saveTableData(tableId);
          sortTableByTime(tableId);
        }
      }

      function updateTable() {
        const table = document
          .getElementById("secondTable")
          .getElementsByTagName("tbody")[0];
        const rows = table.getElementsByTagName("tr");
        for (let row of rows) {
          const dateCell = row.cells[0];
          dateCell.innerHTML = `
            <select class="hijri-select" name="week-day">
              ${weekDays
                .map(
                  (day) =>
                    `<option value="${day}" ${
                      day === weekDay ? "selected" : ""
                    }>${day}</option>`
                )
                .join("")}
            </select>
            <select class="hijri-select" name="hijri-day">
              ${Array.from({ length: 30 }, (_, i) => i + 1)
                .map(
                  (day) =>
                    `<option value="${day}" ${
                      day === hijriDay ? "selected" : ""
                    }>${day}</option>`
                )
                .join("")}
            </select>
            <select class="hijri-select" name="hijri-month">
              ${hijriMonths
                .map(
                  (m, i) =>
                    `<option value="${i + 1}" ${
                      i + 1 === hijriMonth ? "selected" : ""
                    }>${m}</option>`
                )
                .join("")}
            </select>
            <select class="hijri-select" name="hijri-year">
              ${Array.from({ length: 41 }, (_, i) => 1430 + i)
                .map(
                  (year) =>
                    `<option value="${year}" ${
                      year === hijriYear ? "selected" : ""
                    }>${year}</option>`
                )
                .join("")}
            </select>
          `;
        }
      }

      document.addEventListener("DOMContentLoaded", function () {
        populateDateSelects();
        loadTableData("secondTable");

        const weekDaySelect = document.querySelector(
          "select[name='header-week-day']"
        );
        const daySelect = document.querySelector(
          "select[name='header-hijri-day']"
        );
        const monthSelect = document.querySelector(
          "select[name='header-hijri-month']"
        );
        const yearSelect = document.querySelector(
          "select[name='header-hijri-year']"
        );
        weekDaySelect.addEventListener("change", updateHeaderDate);
        daySelect.addEventListener("change", updateHeaderDate);
        monthSelect.addEventListener("change", updateHeaderDate);
        yearSelect.addEventListener("change", updateHeaderDate);
      });
    </script>
  </body>
</html>
